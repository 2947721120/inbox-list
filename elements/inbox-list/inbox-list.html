<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-styles/shadow.html">

<dom-module id="inbox-list">
  <template>
    <style>
      :host {
        display: block;
      }

      iron-selector ::content > * {
        background-color: white;

        -webkit-transition: all 0.4s ease-in-out;
        -moz-transition: all 0.4s ease-in-out;
        -o-transition: all 0.4s ease-in-out;
        transition: all 0.4s ease-in-out;

        width: 98%;
        margin: 0px auto 0px auto;
        @apply(--shadow-elevation-2dp);
      }

      iron-selector ::content > .iron-selected {
        width: 100%;
        margin: 15px auto 15px auto;
        @apply(--shadow-elevation-16dp);
      }

      iron-selector ::content paper-item:focus:before,
      iron-selector ::content paper-icon-item:focus:before {
        background: none;
      }

      iron-selector ::content > :not(.iron-selected) paper-item
      iron-selector ::content > :not(.iron-selected) paper-icon-item {
        cursor: pointer;
      }

      iron-selector ::content > .iron-selected paper-item,
      iron-selector ::content > .iron-selected paper-icon-item {
        font-weight: bold;
      }

    </style>

    <iron-selector id="selector" on-iron-select="_onIronSelect" on-iron-deselect="_onIronDeselect">
      <content></content>
    </iron-selector>
  </template>

  <script>
    (function() {
      'use strict';
  
      Polymer({
        is: 'inbox-list',

        _onIronSelect: function(event) {
          var item = this._highestBeforeSelector(event.detail.item);
          var collapseTags = Polymer.dom(item).querySelectorAll('iron-collapse');
          if (collapseTags) {
            collapseTags.forEach(function(collapse) { collapse.opened = true; });
          }
        },

        _onIronDeselect: function(event) {
          var item = this._highestBeforeSelector(event.detail.item);
          var collapseTags = Polymer.dom(item).querySelectorAll('iron-collapse');
          if (collapseTags) {
            collapseTags.forEach(function(collapse) { collapse.opened = false; });
          }
        },

        _highestBeforeSelector: function(node) {
          var selector = this.$.selector;
          while (node.parentNode !== selector) {
            node = node.parentNode;
          }
          return node;
        },

        ready: function() {
          var elem = this;
          document.addEventListener('click', function(event) {
            /* Callback to close the list if we clicked outside of it */
            var node = event.target;
            while (node) {
              if (node === elem) {
                return;
              }
              node = node.parentNode;
            }
            elem.$.selector.select(null);
          });
        }

      });
    })();
  </script>
</dom-module>